<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkedIn Content Studio v2.0</title>
    <style>
        :root {
            /* Brand Colors */
            --brand-orange: #EF5900;
            --brand-yellow: #FFDF4D;
            --brand-green: #87D156;
            --brand-dark: #050505;
            --brand-gray: #999999;
            --brand-light: #E6E6E6;

            /* Light Theme */
            --bg-gradient-start: #fafafa;
            --bg-gradient-end: #f5f5f5;
            --container-bg: #ffffff;
            --text-primary: #050505;
            --text-secondary: #999999;
            --border-color: #E6E6E6;
            --input-bg: #ffffff;
            --input-border: #E6E6E6;
            --slider-bg: #E6E6E6;
            --slider-fill: #FFDF4D;
            --button-primary-bg: #EF5900;
            --button-primary-hover: #d64f00;
            --button-secondary-bg: #E6E6E6;
            --button-secondary-hover: #999999;
            --card-bg: #f9f9f9;
            --card-hover: #f0f0f0;
        }

        [data-theme="dark"] {
            --bg-gradient-start: #050505;
            --bg-gradient-end: #1a1a1a;
            --container-bg: #1a1a1a;
            --text-primary: #E6E6E6;
            --text-secondary: #999999;
            --border-color: #333333;
            --input-bg: #252525;
            --input-border: #333333;
            --slider-bg: #333333;
            --slider-fill: #FFDF4D;
            --button-primary-bg: #EF5900;
            --button-primary-hover: #ff6b0a;
            --button-secondary-bg: #252525;
            --button-secondary-hover: #333333;
            --card-bg: #252525;
            --card-hover: #2a2a2a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--container-bg);
            min-height: 100vh;
            display: flex;
            margin: 0;
            padding: 0;
            transition: background 0.3s ease;
        }

        /* Left Sidebar Navigation */
        .sidebar {
            width: 240px;
            background: var(--container-bg);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            padding: 20px 0;
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            z-index: 100;
        }

        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .sidebar-logo {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .sidebar-tagline {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .sidebar-nav {
            flex: 1;
            padding: 20px 0;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .sidebar-item {
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            background: none;
            text-align: left;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 10px;
            border-left: 3px solid transparent;
        }

        .sidebar-item:hover {
            background: var(--card-bg);
            color: var(--text-primary);
        }

        .sidebar-item.active {
            color: var(--brand-orange);
            background: var(--card-bg);
            border-left-color: var(--brand-orange);
        }


        /* Main Content Area */
        .main-content {
            margin-left: 240px;
            flex: 1;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Top Header Bar */
        .top-header {
            position: fixed;
            top: 0;
            right: 0;
            left: 240px;
            height: 60px;
            background: var(--container-bg);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding: 0 30px;
            gap: 15px;
            z-index: 50;
        }

        .theme-toggle-wrapper {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .theme-toggle-label {
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .theme-toggle {
            position: relative;
            width: 44px;
            height: 24px;
            background: var(--slider-bg);
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .theme-toggle.dark {
            background: var(--brand-orange);
        }

        .theme-toggle-thumb {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 18px;
            height: 18px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .theme-toggle.dark .theme-toggle-thumb {
            transform: translateX(20px);
        }

        .demo-mode-badge {
            background: #f59e0b;
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            display: none;
        }

        .demo-mode-badge.visible {
            display: block;
        }

        .container {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
            background: var(--container-bg);
            transition: background 0.3s ease;
            margin-top: 60px;
        }

        /* Source & Preferences Views */
        .source-view,
        .preferences-view {
            display: none;
            padding: 40px;
            overflow-y: auto;
        }

        .source-view.visible,
        .preferences-view.visible {
            display: block;
        }

        .content-row {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        /* About You Section */
        .about-section {
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .about-input {
            width: 100%;
            padding: 15px;
            border: 2px solid var(--input-border);
            border-radius: 12px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            min-height: 80px;
            transition: all 0.2s;
            background: var(--input-bg);
            color: var(--text-primary);
        }

        .about-input:focus {
            outline: none;
            border-color: var(--brand-orange);
        }

        /* Tone Sliders */
        .tone-sliders {
            display: grid;
            gap: 25px;
            margin-bottom: 20px;
        }

        .slider-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .slider-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .slider-container {
            position: relative;
            height: 6px;
            background: var(--slider-bg);
            border-radius: 3px;
        }

        .slider {
            position: absolute;
            width: 100%;
            height: 6px;
            opacity: 0;
            cursor: pointer;
            z-index: 2;
        }

        .slider-track {
            position: absolute;
            height: 6px;
            background: var(--slider-fill);
            border-radius: 3px;
            width: 50%;
            left: 0;
        }

        .slider-thumb {
            position: absolute;
            width: 20px;
            height: 20px;
            background: var(--container-bg);
            border: 3px solid var(--brand-orange);
            border-radius: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            left: 50%;
            pointer-events: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        /* Word Length Slider */
        .word-length-section {
            margin-bottom: 20px;
        }

        .dual-slider-container {
            position: relative;
            height: 50px;
            margin-top: 25px;
            padding: 0 12px;
        }

        .dual-slider-track {
            position: absolute;
            top: 23px;
            left: 12px;
            right: 12px;
            height: 4px;
            background: var(--slider-bg);
            border-radius: 2px;
        }

        .dual-slider-range {
            position: absolute;
            top: 23px;
            height: 4px;
            background: var(--slider-fill);
            border-radius: 2px;
            pointer-events: none;
        }

        .dual-slider-input {
            position: absolute;
            top: 15px;
            left: 0;
            width: 100%;
            height: 20px;
            opacity: 0;
            cursor: pointer;
            pointer-events: auto;
        }

        .dual-slider-input:focus {
            outline: none;
        }

        .dual-thumb {
            position: absolute;
            width: 20px;
            height: 20px;
            background: var(--container-bg);
            border: 3px solid var(--brand-orange);
            border-radius: 50%;
            top: 15px;
            cursor: grab;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            z-index: 4;
            pointer-events: none;
        }

        .dual-thumb:active {
            cursor: grabbing;
        }

        .dual-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .word-count-display {
            text-align: center;
            margin-top: 10px;
            font-size: 14px;
            font-weight: 600;
            color: var(--brand-orange);
        }

        /* Source Material */
        .source-input {
            width: 100%;
            min-height: 150px;
            padding: 20px;
            border: 2px solid var(--input-border);
            border-radius: 12px;
            font-size: 15px;
            font-family: inherit;
            resize: vertical;
            transition: all 0.2s;
            background: var(--input-bg);
            color: var(--text-primary);
        }

        .source-input:focus {
            outline: none;
            border-color: var(--brand-orange);
        }

        .generate-btn {
            padding: 16px 40px;
            background: var(--button-primary-bg);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .generate-btn:hover {
            background: var(--button-primary-hover);
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(239, 89, 0, 0.4);
        }

        .generate-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Generator View */
        .generator-view {
            display: none;
            flex-direction: column;
            height: 100%;
        }

        .generator-view.visible {
            display: flex;
        }

        .post-display {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* LinkedIn Preview Phone Frame */
        .phone-frame {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            overflow: hidden;
            max-width: 450px;
            width: 100%;
            margin-bottom: 20px;
        }

        .linkedin-header {
            background: white;
            padding: 12px 16px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .linkedin-logo {
            font-size: 28px;
            color: #0a66c2;
            font-weight: bold;
        }

        .header-undo-redo {
            display: flex;
            gap: 8px;
        }

        .header-undo-btn, .header-redo-btn {
            padding: 6px 10px;
            background: #f3f2ef;
            color: #666;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .header-undo-btn:hover:not(:disabled),
        .header-redo-btn:hover:not(:disabled) {
            background: #e0dfdc;
        }

        .header-undo-btn:disabled,
        .header-redo-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .post-container {
            background: white;
            max-height: 600px;
            overflow-y: auto;
        }

        .post {
            background: white;
            padding-bottom: 12px;
        }

        .post-header {
            padding: 12px 16px;
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }

        .avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 20px;
            flex-shrink: 0;
        }

        .post-author {
            flex: 1;
        }

        .author-name {
            font-weight: 600;
            font-size: 14px;
            color: #000;
            margin-bottom: 2px;
        }

        .author-title {
            font-size: 12px;
            color: #666;
            line-height: 1.3;
        }

        .post-time {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }

        .post-content {
            padding: 0 16px 12px 16px;
            font-size: 14px;
            line-height: 1.5;
            color: #000;
            white-space: pre-wrap;
            min-height: 100px;
            cursor: text;
        }

        .post-content:focus {
            outline: none;
        }

        .post-content.editing {
            outline: 2px solid var(--brand-orange);
            border-radius: 4px;
            padding: 16px;
            margin: 0 16px 12px 16px;
        }

        .post-actions {
            padding: 8px 16px;
            border-top: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-around;
        }

        .linkedin-action-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            color: #666;
            font-size: 13px;
            font-weight: 500;
            background: none;
            border: none;
            padding: 8px 12px;
            cursor: default;
            border-radius: 4px;
        }

        /* Character Counter */
        .char-counter {
            text-align: center;
            margin-top: 10px;
            font-size: 14px;
            font-weight: 600;
            max-width: 450px;
            width: 100%;
        }

        .char-counter.ok {
            color: var(--brand-green);
        }

        .char-counter.warning {
            color: var(--brand-yellow);
        }

        .char-counter.over {
            color: #ef4444;
        }

        .edit-mode-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--brand-orange);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            display: none;
        }

        .post-content.editing .edit-mode-indicator {
            display: block;
        }

        .revert-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 8px 16px;
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            display: none;
            transition: all 0.2s;
        }

        .revert-btn.visible {
            display: block;
        }

        .revert-btn:hover {
            background: #ff5252;
            transform: translateY(-1px);
        }

        .loading-indicator {
            text-align: center;
            color: #999;
            font-size: 14px;
            padding: 40px;
        }

        .generator-actions {
            padding: 20px 40px;
            display: flex;
            gap: 15px;
            border-top: 2px solid var(--border-color);
        }

        .action-btn {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .like-btn {
            background: var(--brand-green);
            color: white;
        }

        .like-btn:hover {
            background: #6fb843;
            transform: translateY(-2px);
        }

        .comment-btn {
            background: var(--brand-orange);
            color: white;
        }

        .comment-btn:hover {
            background: var(--button-primary-hover);
            transform: translateY(-2px);
        }

        .erase-btn {
            background: var(--brand-yellow);
            color: var(--brand-dark);
        }

        .erase-btn:hover {
            background: #f0d03d;
            transform: translateY(-2px);
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Comment Modal */
        .comment-modal {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .comment-modal.visible {
            display: flex;
        }

        .comment-box {
            background: white;
            padding: 30px;
            border-radius: 16px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .comment-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .comment-input {
            width: 100%;
            min-height: 100px;
            padding: 15px;
            border: 2px solid var(--input-border);
            border-radius: 12px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            margin-bottom: 15px;
            background: var(--input-bg);
            color: var(--text-primary);
        }

        .comment-input:focus {
            outline: none;
            border-color: var(--brand-orange);
        }

        .comment-actions {
            display: flex;
            gap: 10px;
        }

        .submit-comment-btn, .cancel-comment-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .submit-comment-btn {
            background: var(--brand-orange);
            color: white;
        }

        .submit-comment-btn:hover {
            background: var(--button-primary-hover);
        }

        .cancel-comment-btn {
            background: var(--button-secondary-bg);
            color: var(--text-secondary);
        }

        .cancel-comment-btn:hover {
            background: var(--button-secondary-hover);
        }

        /* Remove old bottom navigation - now using sidebar */

        /* Drafts & Archive */
        .content-list {
            display: none;
            flex-direction: column;
            height: 100%;
        }

        .content-list.visible {
            display: flex;
        }

        .list-items {
            flex: 1;
            overflow-y: auto;
            padding: 20px 40px;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-content: flex-start;
        }

        .list-item-card {
            width: calc(50% - 10px);
            min-width: 400px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .list-item-phone {
            background: white;
            border-radius: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            overflow: hidden;
            cursor: pointer;
            transition: all 0.2s;
        }

        .list-item-phone:hover {
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }

        .list-item-actions {
            display: flex;
            gap: 10px;
        }

        .copy-btn {
            flex: 1;
            padding: 12px;
            background: var(--brand-green);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .copy-btn:hover {
            background: #6fb843;
            transform: translateY(-1px);
        }

        .archive-btn {
            flex: 1;
            padding: 12px;
            background: var(--brand-orange);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .archive-btn:hover {
            background: var(--button-primary-hover);
            transform: translateY(-1px);
        }


        .draft-post-content {
            cursor: text;
        }

        .draft-post-content.editing {
            outline: 2px solid var(--brand-orange);
            border-radius: 4px;
        }

        .item-meta {
            font-size: 12px;
            color: var(--text-secondary);
            text-align: center;
        }

        .empty-state {
            text-align: center;
            padding: 60px 40px;
            color: var(--text-secondary);
        }

        /* Editor */
        .editor-view {
            display: none;
            flex-direction: column;
            height: 100%;
        }

        .editor-view.visible {
            display: flex;
        }

        .editor-header {
            padding: 30px 40px;
            border-bottom: 2px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .back-btn {
            padding: 10px 20px;
            background: var(--button-secondary-bg);
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.2s;
        }

        .back-btn:hover {
            background: var(--button-secondary-hover);
        }

        .editor-content {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
        }

        .editor-textarea {
            width: 100%;
            min-height: 300px;
            padding: 20px;
            border: 2px solid var(--input-border);
            border-radius: 12px;
            font-size: 15px;
            font-family: inherit;
            line-height: 1.6;
            resize: vertical;
            background: var(--input-bg);
            color: var(--text-primary);
        }

        .editor-textarea:focus {
            outline: none;
            border-color: var(--brand-orange);
        }

        .version-controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            align-items: center;
        }

        .version-btn {
            padding: 10px 20px;
            background: var(--button-secondary-bg);
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-primary);
        }

        .version-btn:hover:not(:disabled) {
            background: var(--button-secondary-hover);
        }

        .version-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .version-info {
            flex: 1;
            text-align: center;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .editor-actions {
            padding: 20px 40px;
            border-top: 2px solid var(--border-color);
            display: flex;
            gap: 15px;
        }

        .finalize-btn {
            flex: 1;
            padding: 16px;
            background: var(--brand-orange);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .finalize-btn:hover {
            background: var(--button-primary-hover);
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(239, 89, 0, 0.4);
        }

        .delete-btn {
            padding: 16px 30px;
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .delete-btn:hover {
            background: #ff5252;
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .container {
                border-radius: 0;
                min-height: 100vh;
            }

            .home-screen, .post-display, .list-items, .editor-content {
                padding: 20px;
            }

            .generator-header, .list-header, .editor-header {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Left Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">Content Studio</div>
            <div class="sidebar-tagline">LinkedIn Post Generator</div>
        </div>

        <div class="sidebar-nav">
            <button class="sidebar-item active" onclick="showView('source')">Source</button>
            <button class="sidebar-item" onclick="showView('preferences')">Preferences</button>
            <button class="sidebar-item" onclick="showView('generator')">Generator</button>
            <button class="sidebar-item" onclick="showView('drafts')">Drafts (<span id="draftsCount">0</span>)</button>
            <button class="sidebar-item" onclick="showView('archive')">Archive (<span id="archiveCount">0</span>)</button>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="main-content">
        <!-- Top Header -->
        <div class="top-header">
            <div class="demo-mode-badge" id="demoModeBadge">Demo Mode - API Offline</div>
            <div class="theme-toggle-wrapper">
                <span class="theme-toggle-label">Dark</span>
                <div class="theme-toggle" id="themeToggle" onclick="toggleTheme()">
                    <div class="theme-toggle-thumb"></div>
                </div>
            </div>
        </div>

        <div class="container">
            <!-- Source View -->
            <div class="source-view visible" id="sourceView">
                <div class="content-row">
                    <div class="about-section">
                        <div class="section-title">About You</div>
                        <textarea class="about-input" id="aboutYou" placeholder="Add context about yourself: your background, expertise, positioning, industry, or any relevant information that should inform the content style..."></textarea>
                    </div>

                    <div class="about-section">
                        <div class="section-title">Custom Instructions</div>
                        <textarea class="about-input" id="customInstructions" placeholder="Any specific instructions for the AI to keep in mind while creating content (e.g., 'Always include a call-to-action', 'Avoid technical jargon', 'Focus on storytelling')..."></textarea>
                    </div>

                    <div class="about-section">
                        <div class="section-title">Source Material</div>
                        <textarea class="source-input" id="sourceMaterial" placeholder="Paste your ideas, notes, or any content you want to transform into a LinkedIn post..."></textarea>
                    </div>

                    <button class="generate-btn" onclick="startGeneration()">Generate Posts</button>
                </div>
            </div>

            <!-- Preferences View -->
            <div class="preferences-view" id="preferencesView">
                <div class="content-row">
                    <div class="section-title">Tone of Voice</div>
                    <div class="tone-sliders" id="toneSliders"></div>

                    <div class="word-length-section">
                        <div class="section-title">Length</div>
                        <div class="dual-slider-container" id="wordLengthContainer">
                            <div class="dual-slider-track"></div>
                            <div class="dual-slider-range" id="wordRange"></div>
                            <input type="range" min="20" max="500" value="100" class="dual-slider-input" id="minSlider">
                            <input type="range" min="20" max="500" value="300" class="dual-slider-input" id="maxSlider">
                            <div class="dual-thumb" id="minThumb"></div>
                            <div class="dual-thumb" id="maxThumb"></div>
                        </div>
                        <div class="dual-labels">
                            <span>20 words</span>
                            <span>500 words</span>
                        </div>
                        <div class="word-count-display" id="wordDisplay">100-300 words</div>
                    </div>
                </div>
            </div>

        <!-- Generator View -->
        <div class="generator-view" id="generatorView">
            <div class="post-display">
                <div class="phone-frame" id="phoneFrame">
                    <div class="linkedin-header">
                        <div class="linkedin-logo">in</div>
                    </div>
                    <div class="post-container">
                        <div class="post">
                            <div class="post-header">
                                <div class="avatar">U</div>
                                <div class="post-author">
                                    <div class="author-name" id="authorName">Your Name</div>
                                    <div class="author-title" id="authorTitle">Your Title</div>
                                    <div class="post-time">Just now</div>
                                </div>
                            </div>
                            <div class="post-content" id="postContent" contenteditable="false" onclick="enableEditing()">
                                <div class="loading-indicator">Generating your first post...</div>
                            </div>
                            <div class="post-actions">
                                <button class="linkedin-action-btn">üëç Like</button>
                                <button class="linkedin-action-btn">üí¨ Comment</button>
                                <button class="linkedin-action-btn">üîÑ Repost</button>
                                <button class="linkedin-action-btn">üì§ Send</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="char-counter ok" id="charCounter">0 characters</div>
                <button class="revert-btn" id="revertBtn" onclick="revertToOriginal()">Revert to Original</button>
            </div>

            <div class="generator-actions">
                <button class="action-btn like-btn" onclick="likePost()">
                    <span>Save to Drafts</span>
                </button>
                <button class="action-btn comment-btn" onclick="openCommentModal()">
                    <span>Improve</span>
                </button>
                <button class="action-btn erase-btn" onclick="erasePost()">
                    <span>Generate New</span>
                </button>
            </div>
        </div>

        <!-- Comment Modal -->
        <div class="comment-modal" id="commentModal">
            <div class="comment-box">
                <div class="comment-title">How should I improve this?</div>
                <textarea class="comment-input" id="commentInput" placeholder="E.g., Make it more casual, focus on the financial benefits, add a personal story..."></textarea>
                <div class="comment-actions">
                    <button class="cancel-comment-btn" onclick="closeCommentModal()">Cancel</button>
                    <button class="submit-comment-btn" onclick="submitComment()">Improve Post</button>
                </div>
            </div>
        </div>

        <!-- Drafts View -->
        <div class="content-list" id="draftsView">
            <div class="list-items" id="draftsList">
                <div class="empty-state">No drafts yet. Like posts in the generator to save them here.</div>
            </div>
        </div>

        <!-- Archive View -->
        <div class="content-list" id="archiveView">
            <div class="list-items" id="archiveList">
                <div class="empty-state">No archived posts yet. Finalize drafts to archive them.</div>
            </div>
        </div>

        <!-- Editor View -->
        <div class="editor-view" id="editorView">
            <div class="editor-header">
                <button class="back-btn" onclick="backToDrafts()">‚Üê Back to Drafts</button>
            </div>
            <div class="editor-content">
                <textarea class="editor-textarea" id="editorTextarea"></textarea>
                <div class="version-controls">
                    <button class="version-btn" onclick="previousVersion()" id="prevVersionBtn">‚Üê Previous</button>
                    <div class="version-info" id="versionInfo">Version 1 of 1</div>
                    <button class="version-btn" onclick="nextVersion()" id="nextVersionBtn">Next ‚Üí</button>
                </div>
            </div>
            <div class="editor-actions">
                <button class="delete-btn" onclick="deleteDraft()">Delete</button>
                <button class="finalize-btn" onclick="finalizeDraft()">Finalize & Archive</button>
            </div>
        </div>

        </div>
    </div>

    <script>
        // State Management
        const state = {
            aboutYou: '',
            customInstructions: '',
            toneSettings: {
                seriousness: 2, // 0=serious, 4=humor
                formality: 2, // 0=formal, 4=casual
                focus: 2, // 0=company, 4=personal
                length: 2, // 0=elaborate, 4=concise
                language: 2, // 0=formal, 4=spoken
                transparency: 2, // 0=secrecy, 4=transparency
                swearing: 0, // 0=no swearing, 4=swearing
                emojis: 2 // 0=no emojis, 4=using emojis
            },
            wordLength: { min: 100, max: 300 },
            sourceMaterial: '',
            currentPost: null,
            originalPost: null,
            hasUserEdits: false,
            reservePost: null,
            isGenerating: false,
            drafts: [],
            archive: [],
            currentDraftId: null,
            editingDraftId: null
        };

        // Tone slider configuration
        const toneSliders = [
            { key: 'seriousness', left: 'Serious', right: 'Humor' },
            { key: 'formality', left: 'Formal', right: 'Casual' },
            { key: 'focus', left: 'Company Focus', right: 'Personal Focus' },
            { key: 'length', left: 'Elaborate', right: 'Concise' },
            { key: 'language', left: 'Formal Language', right: 'Spoken Language' },
            { key: 'transparency', left: 'Secrecy', right: 'Transparency' },
            { key: 'swearing', left: 'No Swearing', right: 'Swearing' },
            { key: 'emojis', left: 'No Emojis', right: 'Using Emojis' }
        ];

        // Generic Content Principles (no personal info)
        const contentPrinciples = `
# LinkedIn Content Principles

## Voice & Style
- Mix expertise with personal storytelling when relevant
- Use source material to maintain authentic voice
- Sentences should vary in length (some short, some longer)
- Text should flow smoothly and naturally, not choppy or mechanical
- Professional but authentic‚Äîno corporate jargon or buzzwords
- Opinionated but not arrogant

## What NOT to Use
- ‚ùå "It's not X, it's Y" constructions
- ‚ùå Long dashes (‚Äî)
- ‚ùå Bold or italics
- ‚ùå Made-up analogies or stories (only use source material)
- ‚ùå Corporate speak or generic marketing advice
- ‚ùå Forced engagement questions

## Formatting
- Paragraphs separated by line breaks for readability
- Bullet points allowed when natural for the topic
- First line must hook in feed view
- Short paragraphs (2-3 lines max)
- Generous line breaks

## Ending
- Questions at the end are optional
- If included, must feel natural and never forced
- Not every post needs a closing question

## Core Approach
- Specific over general
- Show work, share real examples
- Include specific numbers/examples when available
- Natural engagement when appropriate
- Tie back to professional value proposition
`;

        // Initialize
        function init() {
            renderToneSliders();
            setupDualSlider('minSlider', 'maxSlider', 'wordRange', 'minThumb', 'maxThumb', 'wordDisplay');
        }

        // Render tone sliders
        function renderToneSliders() {
            const container = document.getElementById('toneSliders');
            container.innerHTML = toneSliders.map(slider => `
                <div class="slider-group">
                    <div class="slider-labels">
                        <span>${slider.left}</span>
                        <span>${slider.right}</span>
                    </div>
                    <div class="slider-container">
                        <input type="range" min="0" max="4" value="${state.toneSettings[slider.key]}"
                               class="slider" id="toneSliders-${slider.key}"
                               oninput="updateToneSlider('${slider.key}', this.value)">
                        <div class="slider-track" id="toneSliders-${slider.key}-track"></div>
                        <div class="slider-thumb" id="toneSliders-${slider.key}-thumb"></div>
                    </div>
                </div>
            `).join('');

            // Initialize slider positions
            toneSliders.forEach(slider => {
                updateSliderVisuals(slider.key, state.toneSettings[slider.key]);
            });
        }

        // Update tone slider
        function updateToneSlider(key, value) {
            state.toneSettings[key] = parseInt(value);
            updateSliderVisuals(key, value);
        }

        // Update slider visuals
        function updateSliderVisuals(key, value) {
            const percentage = (value / 4) * 100;
            const track = document.getElementById(`toneSliders-${key}-track`);
            const thumb = document.getElementById(`toneSliders-${key}-thumb`);

            if (track && thumb) {
                track.style.width = percentage + '%';
                thumb.style.left = percentage + '%';
            }
        }

        // Setup dual slider for word length
        function setupDualSlider(minId, maxId, rangeId, minThumbId, maxThumbId, displayId) {
            const minSlider = document.getElementById(minId);
            const maxSlider = document.getElementById(maxId);
            const range = document.getElementById(rangeId);
            const minThumb = document.getElementById(minThumbId);
            const maxThumb = document.getElementById(maxThumbId);
            const display = document.getElementById(displayId);

            if (!minSlider || !maxSlider) return;

            function updateSlider() {
                let minVal = parseInt(minSlider.value);
                let maxVal = parseInt(maxSlider.value);

                // Ensure minimum gap of 20 words
                if (minVal > maxVal - 20) {
                    minVal = maxVal - 20;
                    minSlider.value = minVal;
                }
                if (maxVal < minVal + 20) {
                    maxVal = minVal + 20;
                    maxSlider.value = maxVal;
                }

                // Calculate percentages (0-100%)
                const minPercent = ((minVal - 20) / 480) * 100;
                const maxPercent = ((maxVal - 20) / 480) * 100;

                // Update range bar
                range.style.left = minPercent + '%';
                range.style.width = (maxPercent - minPercent) + '%';

                // Update thumbs (centered on their position)
                minThumb.style.left = `calc(${minPercent}% - 10px)`;
                maxThumb.style.left = `calc(${maxPercent}% - 10px)`;

                // Update display
                display.textContent = `${minVal}-${maxVal} words`;

                // Update state
                state.wordLength.min = minVal;
                state.wordLength.max = maxVal;
            }

            minSlider.addEventListener('input', updateSlider);
            maxSlider.addEventListener('input', updateSlider);

            // Fix: Make sure the correct slider responds to mouse position
            const container = minSlider.parentElement;
            container.addEventListener('mousedown', (e) => {
                const rect = container.getBoundingClientRect();
                const clickPercent = (e.clientX - rect.left - 12) / (rect.width - 24) * 100; // Adjust for padding
                const minPercent = ((parseInt(minSlider.value) - 20) / 480) * 100;
                const maxPercent = ((parseInt(maxSlider.value) - 20) / 480) * 100;
                const midPercent = (minPercent + maxPercent) / 2;

                // Determine which slider is closer to the click
                if (clickPercent < midPercent) {
                    // Closer to min, disable max temporarily
                    maxSlider.style.pointerEvents = 'none';
                    minSlider.style.pointerEvents = 'auto';
                } else {
                    // Closer to max, disable min temporarily
                    minSlider.style.pointerEvents = 'none';
                    maxSlider.style.pointerEvents = 'auto';
                }
            });

            // Re-enable both after mouse up
            document.addEventListener('mouseup', () => {
                setTimeout(() => {
                    minSlider.style.pointerEvents = 'auto';
                    maxSlider.style.pointerEvents = 'auto';
                }, 100);
            });

            // Initial update
            updateSlider();
        }

        // Update author info in preview
        function updateAuthorInfo() {
            const aboutYou = state.aboutYou || '';
            const lines = aboutYou.split('\n').filter(line => line.trim());

            // Try to extract name and title from first lines
            const authorName = document.getElementById('authorName');
            const authorTitle = document.getElementById('authorTitle');
            const avatar = document.querySelector('.avatar');

            if (lines.length > 0) {
                // Use first line or first sentence as name
                const firstLine = lines[0].trim();
                authorName.textContent = firstLine.length > 50 ? firstLine.substring(0, 50) + '...' : firstLine;

                // Use initials for avatar
                const words = firstLine.split(' ');
                const initials = words.length > 1 ?
                    words[0][0].toUpperCase() + words[words.length-1][0].toUpperCase() :
                    words[0][0].toUpperCase();
                avatar.textContent = initials;
            }

            if (lines.length > 1) {
                // Use remaining text as title
                const titleText = lines.slice(1, 3).join(' ‚Ä¢ ');
                authorTitle.textContent = titleText.length > 100 ? titleText.substring(0, 100) + '...' : titleText;
            }
        }

        // Start generation
        async function startGeneration() {
            state.aboutYou = document.getElementById('aboutYou').value.trim();
            state.customInstructions = document.getElementById('customInstructions').value.trim();
            state.sourceMaterial = document.getElementById('sourceMaterial').value.trim();

            if (!state.aboutYou) {
                alert('Please add information about yourself in the "About You" section.');
                return;
            }

            if (!state.sourceMaterial) {
                alert('Please enter some source material to transform into a post.');
                return;
            }

            // Show generator view
            showView('generator');

            // Update author info in preview
            updateAuthorInfo();

            // Generate first post
            await generateNewPost();
        }

        // Generate new post
        async function generateNewPost() {
            if (state.isGenerating) return;

            state.isGenerating = true;
            const postContent = document.getElementById('postContent');
            postContent.innerHTML = '<div class="loading-indicator">Generating post...</div>';
            disableActions(true);

            try {
                const prompt = buildPrompt(state.sourceMaterial, null);
                const content = await callClaudeAPI(prompt);
                
                state.currentPost = content;
                state.originalPost = content;
                state.hasUserEdits = false;
                
                displayPost(content);
                disableActions(false);

                // Generate reserve post in background
                generateReservePost();
            } catch (error) {
                console.error('Generation error:', error);
                postContent.innerHTML = '<div class="loading-indicator">Error generating post. Please try again.</div>';
                disableActions(false);
            }

            state.isGenerating = false;
        }

        // Generate reserve post in background
        async function generateReservePost() {
            try {
                const prompt = buildPrompt(state.sourceMaterial, state.currentPost);
                const content = await callClaudeAPI(prompt);
                state.reservePost = content;
            } catch (error) {
                console.error('Reserve generation error:', error);
            }
        }

        // Build prompt for API
        function buildPrompt(sourceMaterial, previousPost) {
            const toneDescription = buildToneDescription();
            const wordRange = `${state.wordLength.min}-${state.wordLength.max}`;

            let prompt = `You are a LinkedIn content creator.

ABOUT THE AUTHOR:
${state.aboutYou}

${state.customInstructions ? `CUSTOM INSTRUCTIONS:\n${state.customInstructions}\n` : ''}
SOURCE MATERIAL:
${sourceMaterial}

CONTENT PRINCIPLES:
${contentPrinciples}

TONE OF VOICE:
${toneDescription}

REQUIREMENTS:
- Create ONE engaging LinkedIn post
- Word count: ${wordRange} words
- Follow all content principles above
${state.customInstructions ? '- Follow the custom instructions provided\n' : ''}- Match the tone of voice settings
- Use the source material as the basis
- Be specific, show examples when possible
${previousPost ? '\n- Create a DIFFERENT angle/approach than the previous post\n- Vary structure and style significantly' : ''}

${previousPost ? `\nPREVIOUS POST (create something DIFFERENT):\n${previousPost}` : ''}

OUTPUT ONLY THE POST CONTENT. Do not include any preamble, explanation, or meta-commentary.`;

            return prompt;
        }

        // Build tone description from sliders
        function buildToneDescription() {
            const levels = ['Very', 'Somewhat', 'Neutral', 'Somewhat', 'Very'];
            const descriptions = [];

            toneSliders.forEach(slider => {
                const value = state.toneSettings[slider.key];
                const level = levels[value];
                
                if (value < 2) {
                    descriptions.push(`${level} ${slider.left.toLowerCase()}`);
                } else if (value > 2) {
                    descriptions.push(`${level} ${slider.right.toLowerCase()}`);
                }
            });

            return descriptions.length > 0 ? descriptions.join(', ') : 'Neutral tone across all dimensions';
        }

        // Demo mode state
        let isDemoMode = false;
        let demoPostIndex = 0;

        // Sample demo posts for offline testing
        const demoPosts = [
            `Just wrapped up a fascinating project that completely changed how I think about content creation.

Three months ago, I was spending 4-5 hours per day manually crafting social posts. The quality was inconsistent, and I was constantly second-guessing my voice.

Then I built a simple system that combines AI with my personal writing principles. Not to replace creativity, but to amplify it.

The results?
‚Üí Content production time cut by 60%
‚Üí Engagement up 3x across all platforms
‚Üí More time for strategy and relationship building

The key wasn't the technology. It was getting crystal clear on my content principles first. The AI is just a really smart assistant that helps me stay consistent with those principles.

Anyone else experimenting with AI-assisted workflows? What's working for you?`,

            `Here's something nobody talks about when starting a consulting business: pricing.

I spent my first 6 months charging way too little. ‚Ç¨50/hour felt "safe" but it was killing my business.

Then a mentor asked me a simple question: "What would happen if you doubled your rate?"

I thought I'd lose all my clients. Instead, three things happened:

1. I started attracting better clients who valued expertise
2. I could focus on fewer, higher-quality projects
3. I actually had time to deliver exceptional work

Now at ‚Ç¨100/hour, I'm booking out weeks in advance. Same skills, same work quality - just different positioning.

The lesson? Your rate isn't just about money. It's a signal about the value you provide.

What's been your biggest pricing lesson?`,

            `Most B2B marketing advice is useless for small businesses.

"Build a content calendar" - sure, but with what team?
"Run A/B tests" - great, when you have 10K monthly visitors
"Invest in brand awareness" - with what budget?

Here's what actually works when you're small:

Focus on one channel. Master it completely.

For me, it's LinkedIn. I post 3x per week, engage daily, and turn conversations into clients. That's it.

No fancy funnel. No automation. No growth hacks.

Just consistent, valuable content + genuine relationships.

Revenue from LinkedIn this year: ‚Ç¨180K+

You don't need to be everywhere. You need to be excellent somewhere.`,

            `Yesterday a potential client asked me to work for equity instead of cash.

"Think of the upside!" they said.

Here's the thing about equity: it's worth exactly ‚Ç¨0 until it isn't.

I'm a consultant, not a co-founder. My rent doesn't accept equity. My expertise has market value right now, not in 3-5 years "when we exit."

If someone can't pay your rate, one of three things is true:
‚Üí They can't afford you (not your ideal client)
‚Üí They don't value what you do (not your ideal client)
‚Üí You haven't demonstrated your value (work on positioning)

Equity can be part of the deal. But never the whole deal.

Your time and expertise are valuable today. Price accordingly.`,

            `Three years ago, I was the "marketing guy" doing everything.

SEO, paid ads, content, email, social, design, analytics... spreading myself thin across every channel.

The result? Mediocre outcomes everywhere.

Then I made a hard choice: specialize ruthlessly.

Now I do one thing: AI-powered B2B marketing strategy for SaaS and hospitality.

That's it.

Counterintuitively, limiting my scope expanded my opportunities:
‚Üí I became known for something specific
‚Üí Clients started referring similar businesses
‚Üí I could charge premium rates for deep expertise

The riches are in the niches isn't just a saying. It's a business strategy.

What did you stop doing that made your business stronger?`
        ];

        // Call Claude API (with demo mode fallback)
        async function callClaudeAPI(prompt) {
            try {
                const response = await fetch("https://api.anthropic.com/v1/messages", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        model: "claude-3-7-sonnet-20250219",
                        max_tokens: 1500,
                        messages: [
                            { role: "user", content: prompt }
                        ]
                    })
                });

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status}`);
                }

                const data = await response.json();
                isDemoMode = false;
                hideDemoModeIndicator();
                return data.content[0].text.trim();
            } catch (error) {
                // Switch to demo mode if API fails
                console.log('API unavailable, switching to demo mode');
                isDemoMode = true;
                showDemoModeIndicator();

                // Return a demo post
                const post = demoPosts[demoPostIndex % demoPosts.length];
                demoPostIndex++;

                // Add a small delay to simulate API call
                await new Promise(resolve => setTimeout(resolve, 1000));

                return post;
            }
        }

        // Show demo mode indicator
        function showDemoModeIndicator() {
            const badge = document.getElementById('demoModeBadge');
            if (badge) {
                badge.classList.add('visible');
            }
        }

        // Hide demo mode indicator
        function hideDemoModeIndicator() {
            const badge = document.getElementById('demoModeBadge');
            if (badge) {
                badge.classList.remove('visible');
            }
        }

        // Update character counter
        function updateCharCounter() {
            const postContent = document.getElementById('postContent');
            const charCounter = document.getElementById('charCounter');
            const text = postContent.textContent || '';
            const count = text.length;

            charCounter.textContent = `${count} characters`;

            // LinkedIn has a 3000 character limit, but ideal is under 1300
            charCounter.classList.remove('ok', 'warning', 'over');
            if (count > 3000) {
                charCounter.classList.add('over');
            } else if (count > 1300) {
                charCounter.classList.add('warning');
            } else {
                charCounter.classList.add('ok');
            }
        }

        // Display post
        function displayPost(content) {
            const postContent = document.getElementById('postContent');
            postContent.textContent = content;
            postContent.contentEditable = 'false';
            postContent.classList.remove('editing');
            document.getElementById('revertBtn').classList.remove('visible');
            updateCharCounter();
        }

        // Enable editing in generator
        function enableEditing() {
            const postContent = document.getElementById('postContent');
            if (!postContent.classList.contains('editing')) {
                postContent.contentEditable = 'true';
                postContent.classList.add('editing');
                postContent.focus();
                
                // Move cursor to end
                const range = document.createRange();
                const sel = window.getSelection();
                range.selectNodeContents(postContent);
                range.collapse(false);
                sel.removeAllRanges();
                sel.addRange(range);
            }
        }

        // Monitor for user edits
        document.addEventListener('DOMContentLoaded', () => {
            const postContent = document.getElementById('postContent');

            // Handle input changes
            postContent.addEventListener('input', () => {
                updateCharCounter(); // Update character count

                if (postContent.classList.contains('editing')) {
                    const currentContent = postContent.textContent;
                    if (currentContent !== state.originalPost) {
                        state.hasUserEdits = true;
                        state.currentPost = currentContent;
                        document.getElementById('revertBtn').classList.add('visible');
                    } else {
                        state.hasUserEdits = false;
                        document.getElementById('revertBtn').classList.remove('visible');
                    }
                }
            });

            // Click outside to de-highlight editor
            document.addEventListener('click', (e) => {
                if (postContent.classList.contains('editing')) {
                    const phoneFrame = document.getElementById('phoneFrame');
                    // Check if click is outside the phone frame
                    if (phoneFrame && !phoneFrame.contains(e.target)) {
                        postContent.classList.remove('editing');
                        postContent.contentEditable = 'false';
                    }
                }
            });
        });

        // Revert to original
        function revertToOriginal() {
            state.currentPost = state.originalPost;
            state.hasUserEdits = false;
            displayPost(state.originalPost);
        }

        // Action buttons
        function disableActions(disabled) {
            document.querySelectorAll('.generator-actions .action-btn').forEach(btn => {
                btn.disabled = disabled;
            });
        }

        // Like post
        async function likePost() {
            const draft = {
                id: Date.now(),
                content: state.currentPost,
                versions: [state.currentPost],
                versionIndex: 0,
                timestamp: new Date().toISOString()
            };

            state.drafts.push(draft);
            updateDraftsList();

            // Use reserve post if available, otherwise generate new
            if (state.reservePost) {
                state.currentPost = state.reservePost;
                state.originalPost = state.reservePost;
                state.hasUserEdits = false;
                state.reservePost = null;
                
                displayPost(state.currentPost);
                
                // Generate new reserve
                generateReservePost();
            } else {
                await generateNewPost();
            }
        }

        // Comment modal
        function openCommentModal() {
            document.getElementById('commentModal').classList.add('visible');
            document.getElementById('commentInput').value = '';
            document.getElementById('commentInput').focus();
        }

        function closeCommentModal() {
            document.getElementById('commentModal').classList.remove('visible');
        }

        // Submit comment
        async function submitComment() {
            const feedback = document.getElementById('commentInput').value.trim();
            if (!feedback) return;

            closeCommentModal();

            const postContent = document.getElementById('postContent');
            postContent.innerHTML = '<div class="loading-indicator">Improving post based on your feedback...</div>';
            disableActions(true);

            try {
                const prompt = `You are revising a LinkedIn post based on user feedback.

ORIGINAL POST:
${state.currentPost}

USER FEEDBACK:
${feedback}

CONTENT PRINCIPLES:
${contentPrinciples}

TONE OF VOICE:
${buildToneDescription()}

REQUIREMENTS:
- Revise the post incorporating the user's feedback
- Word count: ${state.wordLength.min}-${state.wordLength.max} words
- Maintain the core message but adjust as requested
- Follow all content principles

OUTPUT ONLY THE REVISED POST. No preamble or explanation.`;

                const content = await callClaudeAPI(prompt);
                
                state.currentPost = content;
                state.originalPost = content;
                state.hasUserEdits = false;
                
                displayPost(content);
                disableActions(false);

                // Generate new reserve
                generateReservePost();
            } catch (error) {
                console.error('Revision error:', error);
                postContent.innerHTML = '<div class="loading-indicator">Error improving post. Please try again.</div>';
                disableActions(false);
            }
        }

        // Erase post
        async function erasePost() {
            // Use reserve if available
            if (state.reservePost) {
                state.currentPost = state.reservePost;
                state.originalPost = state.reservePost;
                state.hasUserEdits = false;
                state.reservePost = null;
                
                displayPost(state.currentPost);
                
                // Generate new reserve
                generateReservePost();
            } else {
                await generateNewPost();
            }
        }

        // Update navigation counts
        function updateNavCounts() {
            document.getElementById('draftsCount').textContent = state.drafts.length;
            document.getElementById('archiveCount').textContent = state.archive.length;
        }

        // Copy to clipboard
        function copyToClipboard(text, id) {
            navigator.clipboard.writeText(text).then(() => {
                const btn = document.querySelector(`[data-copy-id="${id}"]`);
                if (btn) {
                    const originalText = btn.textContent;
                    btn.textContent = 'Copied!';
                    setTimeout(() => {
                        btn.textContent = originalText;
                    }, 2000);
                }
            });
        }

        // Create phone mockup HTML
        function createPhoneMockup(content, draftId = null, isEditable = false) {
            const aboutYou = state.aboutYou || 'Your Name';
            const lines = aboutYou.split('\n').filter(line => line.trim());
            const firstLine = lines.length > 0 ? lines[0].trim() : 'Your Name';
            const authorName = firstLine.length > 50 ? firstLine.substring(0, 50) + '...' : firstLine;

            const words = firstLine.split(' ');
            const initials = words.length > 1 ?
                words[0][0].toUpperCase() + words[words.length-1][0].toUpperCase() :
                words[0][0].toUpperCase();

            const titleText = lines.length > 1 ? lines.slice(1, 3).join(' ‚Ä¢ ') : 'Your Title';
            const authorTitle = titleText.length > 100 ? titleText.substring(0, 100) + '...' : titleText;

            const contentClass = isEditable ? 'post-content draft-post-content' : 'post-content';
            const contentEditableAttr = isEditable ? 'contenteditable="true"' : '';
            const contentId = isEditable ? `draft-content-${draftId}` : '';
            const onClick = isEditable ? `onclick="enableDraftEditing(${draftId})"` : '';

            // Add undo/redo buttons for editable drafts
            let undoRedoButtons = '';
            if (isEditable && draftId !== null) {
                const draft = state.drafts.find(d => d.id === draftId);
                const canUndo = draft && draft.versionIndex > 0;
                const canRedo = draft && draft.versionIndex < draft.versions.length - 1;

                undoRedoButtons = `
                    <div class="header-undo-redo">
                        <button class="header-undo-btn" id="undo-${draftId}" ${!canUndo ? 'disabled' : ''} onclick="event.stopPropagation(); undoDraft(${draftId})">‚Üê</button>
                        <button class="header-redo-btn" id="redo-${draftId}" ${!canRedo ? 'disabled' : ''} onclick="event.stopPropagation(); redoDraft(${draftId})">‚Üí</button>
                    </div>
                `;
            }

            return `
                <div class="linkedin-header">
                    <div class="linkedin-logo">in</div>
                    ${undoRedoButtons}
                </div>
                <div class="post-container">
                    <div class="post">
                        <div class="post-header">
                            <div class="avatar">${initials}</div>
                            <div class="post-author">
                                <div class="author-name">${authorName}</div>
                                <div class="author-title">${authorTitle}</div>
                                <div class="post-time">Just now</div>
                            </div>
                        </div>
                        <div class="${contentClass}" id="${contentId}" ${contentEditableAttr} ${onClick} style="white-space: pre-wrap;">${content}</div>
                        <div class="post-actions">
                            <button class="linkedin-action-btn">üëç Like</button>
                            <button class="linkedin-action-btn">üí¨ Comment</button>
                            <button class="linkedin-action-btn">üîÑ Repost</button>
                            <button class="linkedin-action-btn">üì§ Send</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function updateDraftsList() {
            const list = document.getElementById('draftsList');

            if (state.drafts.length === 0) {
                list.innerHTML = '<div class="empty-state">No drafts yet. Like posts in the generator to save them here.</div>';
            } else {
                list.innerHTML = state.drafts.map(draft => {
                    const date = new Date(draft.timestamp).toLocaleDateString();
                    const currentVersionContent = draft.versions[draft.versionIndex];

                    return `
                        <div class="list-item-card">
                            <div class="list-item-phone">
                                ${createPhoneMockup(currentVersionContent, draft.id, true)}
                            </div>
                            <div class="list-item-actions">
                                <button class="copy-btn" data-copy-id="${draft.id}" onclick="event.stopPropagation(); copyToClipboard(\`${currentVersionContent.replace(/`/g, '\\`').replace(/\$/g, '\\$')}\`, ${draft.id})">Copy</button>
                                <button class="archive-btn" onclick="event.stopPropagation(); archiveDraft(${draft.id})">Archive</button>
                            </div>
                            <div class="item-meta">Saved ${date}</div>
                        </div>
                    `;
                }).join('');

                // Attach input listeners for auto-save
                state.drafts.forEach(draft => {
                    const contentEl = document.getElementById(`draft-content-${draft.id}`);
                    if (contentEl && !contentEl.dataset.listenerAttached) {
                        contentEl.dataset.listenerAttached = 'true';
                        contentEl.addEventListener('input', () => handleDraftEdit(draft.id));
                    }
                });
            }

            updateNavCounts();
        }

        // Update archive list
        function updateArchiveList() {
            const list = document.getElementById('archiveList');

            if (state.archive.length === 0) {
                list.innerHTML = '<div class="empty-state">No archived posts yet. Finalize drafts to archive them.</div>';
            } else {
                list.innerHTML = state.archive.map(post => {
                    const date = new Date(post.timestamp).toLocaleDateString();

                    return `
                        <div class="list-item-card">
                            <div class="list-item-phone">
                                ${createPhoneMockup(post.content)}
                            </div>
                            <div class="list-item-actions">
                                <button class="copy-btn" data-copy-id="${post.id}" onclick="event.stopPropagation(); copyToClipboard(\`${post.content.replace(/`/g, '\\`').replace(/\$/g, '\\$')}\`, ${post.id})">Copy</button>
                            </div>
                            <div class="item-meta">Archived ${date}</div>
                        </div>
                    `;
                }).join('');
            }

            updateNavCounts();
        }

        // Enable draft editing
        function enableDraftEditing(draftId) {
            const contentEl = document.getElementById(`draft-content-${draftId}`);
            if (contentEl) {
                contentEl.classList.add('editing');
                contentEl.focus();
            }
        }

        // Handle draft edit with auto-save
        let draftEditTimeout = null;
        function handleDraftEdit(draftId) {
            // Clear existing timeout
            if (draftEditTimeout) {
                clearTimeout(draftEditTimeout);
            }

            // Set new timeout for auto-save (500ms debounce)
            draftEditTimeout = setTimeout(() => {
                const draft = state.drafts.find(d => d.id === draftId);
                const contentEl = document.getElementById(`draft-content-${draftId}`);

                if (draft && contentEl) {
                    const newContent = contentEl.textContent;

                    // Only save if content actually changed
                    if (newContent !== draft.versions[draft.versionIndex]) {
                        // Truncate versions after current index if we're not at the end
                        draft.versions = draft.versions.slice(0, draft.versionIndex + 1);

                        // Add new version
                        draft.versions.push(newContent);
                        draft.versionIndex++;
                        draft.content = newContent;

                        // Update only the undo/redo buttons without re-rendering everything
                        updateUndoRedoButtons(draftId);
                    }
                }
            }, 500);
        }

        // Update undo/redo button states without re-rendering
        function updateUndoRedoButtons(draftId) {
            const draft = state.drafts.find(d => d.id === draftId);
            if (!draft) return;

            const undoBtn = document.getElementById(`undo-${draftId}`);
            const redoBtn = document.getElementById(`redo-${draftId}`);

            if (undoBtn) {
                undoBtn.disabled = draft.versionIndex <= 0;
            }
            if (redoBtn) {
                redoBtn.disabled = draft.versionIndex >= draft.versions.length - 1;
            }
        }

        // Undo draft change
        function undoDraft(draftId) {
            const draft = state.drafts.find(d => d.id === draftId);
            if (draft && draft.versionIndex > 0) {
                draft.versionIndex--;
                draft.content = draft.versions[draft.versionIndex];

                // Update content without re-rendering
                const contentEl = document.getElementById(`draft-content-${draftId}`);
                if (contentEl) {
                    contentEl.textContent = draft.content;
                }

                // Update button states
                updateUndoRedoButtons(draftId);
            }
        }

        // Redo draft change
        function redoDraft(draftId) {
            const draft = state.drafts.find(d => d.id === draftId);
            if (draft && draft.versionIndex < draft.versions.length - 1) {
                draft.versionIndex++;
                draft.content = draft.versions[draft.versionIndex];

                // Update content without re-rendering
                const contentEl = document.getElementById(`draft-content-${draftId}`);
                if (contentEl) {
                    contentEl.textContent = draft.content;
                }

                // Update button states
                updateUndoRedoButtons(draftId);
            }
        }

        // Archive draft directly from drafts view
        function archiveDraft(draftId) {
            const draft = state.drafts.find(d => d.id === draftId);
            if (!draft) return;

            // Add to archive
            state.archive.push({
                id: Date.now(),
                content: draft.content,
                timestamp: new Date().toISOString()
            });

            // Remove from drafts
            state.drafts = state.drafts.filter(d => d.id !== draftId);

            // Update both lists
            updateDraftsList();
            updateArchiveList();
        }

        // View archived post (read-only)
        function viewArchive(id) {
            const post = state.archive.find(p => p.id === id);
            if (!post) return;

            // Show in editor as read-only
            const textarea = document.getElementById('editorTextarea');
            textarea.value = post.content;
            textarea.readOnly = true;
            textarea.style.background = '#f9f9f9';
            
            // Hide version controls and action buttons for archive view
            document.querySelector('.version-controls').style.display = 'none';
            document.querySelector('.editor-actions').style.display = 'none';
            
            // Change back button text
            document.querySelector('.back-btn').textContent = '‚Üê Back to Archive';
            document.querySelector('.back-btn').onclick = () => {
                textarea.readOnly = false;
                textarea.style.background = 'white';
                document.querySelector('.version-controls').style.display = 'flex';
                document.querySelector('.editor-actions').style.display = 'flex';
                document.querySelector('.back-btn').textContent = '‚Üê Back to Drafts';
                document.querySelector('.back-btn').onclick = backToDrafts;
                showView('archive');
            };
            
            showView('editor');
        }

        // Open draft in editor
        function openDraft(id) {
            const draft = state.drafts.find(d => d.id === id);
            if (!draft) return;

            state.currentDraftId = id;
            
            document.getElementById('editorTextarea').value = draft.content;
            updateVersionControls(draft);
            
            showView('editor');
        }

        // Update version controls
        function updateVersionControls(draft) {
            const info = document.getElementById('versionInfo');
            const prevBtn = document.getElementById('prevVersionBtn');
            const nextBtn = document.getElementById('nextVersionBtn');

            info.textContent = `Version ${draft.versionIndex + 1} of ${draft.versions.length}`;
            prevBtn.disabled = draft.versionIndex === 0;
            nextBtn.disabled = draft.versionIndex === draft.versions.length - 1;
        }

        // Version navigation
        function previousVersion() {
            const draft = state.drafts.find(d => d.id === state.currentDraftId);
            if (!draft || draft.versionIndex === 0) return;

            // Save current content
            draft.versions[draft.versionIndex] = document.getElementById('editorTextarea').value;
            
            draft.versionIndex--;
            document.getElementById('editorTextarea').value = draft.versions[draft.versionIndex];
            updateVersionControls(draft);
        }

        function nextVersion() {
            const draft = state.drafts.find(d => d.id === state.currentDraftId);
            if (!draft || draft.versionIndex === draft.versions.length - 1) return;

            // Save current content
            draft.versions[draft.versionIndex] = document.getElementById('editorTextarea').value;
            
            draft.versionIndex++;
            document.getElementById('editorTextarea').value = draft.versions[draft.versionIndex];
            updateVersionControls(draft);
        }

        // Editor textarea auto-save
        document.addEventListener('DOMContentLoaded', () => {
            const textarea = document.getElementById('editorTextarea');
            textarea.addEventListener('input', () => {
                const draft = state.drafts.find(d => d.id === state.currentDraftId);
                if (draft) {
                    draft.content = textarea.value;
                    draft.versions[draft.versionIndex] = textarea.value;
                }
            });
        });

        // Back to drafts
        function backToDrafts() {
            showView('drafts');
        }

        // Delete draft
        function deleteDraft() {
            if (!confirm('Are you sure you want to delete this draft?')) return;

            state.drafts = state.drafts.filter(d => d.id !== state.currentDraftId);
            updateDraftsList();
            showView('drafts');
        }

        // Finalize draft
        function finalizeDraft() {
            const draft = state.drafts.find(d => d.id === state.currentDraftId);
            if (!draft) return;

            // Add to archive
            state.archive.push({
                id: Date.now(),
                content: draft.content,
                timestamp: new Date().toISOString()
            });

            // Remove from drafts
            state.drafts = state.drafts.filter(d => d.id !== state.currentDraftId);
            
            updateDraftsList();
            updateArchiveList();
            showView('archive');
        }

        // View navigation
        function showView(view) {
            // Hide all views
            document.getElementById('sourceView').classList.remove('visible');
            document.getElementById('preferencesView').classList.remove('visible');
            document.getElementById('generatorView').classList.remove('visible');
            document.getElementById('draftsView').classList.remove('visible');
            document.getElementById('archiveView').classList.remove('visible');
            document.getElementById('editorView').classList.remove('visible');

            // Remove active state from all sidebar items
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
            });

            // Show selected view
            switch(view) {
                case 'source':
                    document.getElementById('sourceView').classList.add('visible');
                    document.querySelectorAll('.sidebar-item')[0].classList.add('active');
                    break;
                case 'preferences':
                    document.getElementById('preferencesView').classList.add('visible');
                    document.querySelectorAll('.sidebar-item')[1].classList.add('active');
                    break;
                case 'generator':
                    document.getElementById('generatorView').classList.add('visible');
                    document.querySelectorAll('.sidebar-item')[2].classList.add('active');
                    break;
                case 'drafts':
                    document.getElementById('draftsView').classList.add('visible');
                    document.querySelectorAll('.sidebar-item')[3].classList.add('active');
                    updateDraftsList();
                    break;
                case 'archive':
                    document.getElementById('archiveView').classList.add('visible');
                    document.querySelectorAll('.sidebar-item')[4].classList.add('active');
                    updateArchiveList();
                    break;
                case 'editor':
                    document.getElementById('editorView').classList.add('visible');
                    break;
            }
        }

        // Theme Management
        function toggleTheme() {
            const html = document.documentElement;
            const themeToggle = document.getElementById('themeToggle');
            const currentTheme = html.getAttribute('data-theme');

            if (currentTheme === 'dark') {
                html.removeAttribute('data-theme');
                themeToggle.classList.remove('dark');
                localStorage.setItem('theme', 'light');
            } else {
                html.setAttribute('data-theme', 'dark');
                themeToggle.classList.add('dark');
                localStorage.setItem('theme', 'dark');
            }
        }

        // Load saved theme on page load
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme');
            const themeToggle = document.getElementById('themeToggle');

            if (savedTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                if (themeToggle) themeToggle.classList.add('dark');
            }
        }

        // Keyboard shortcuts for undo/redo
        document.addEventListener('keydown', (e) => {
            // Only handle shortcuts if we're editing a draft
            if (state.editingDraftId) {
                if ((e.ctrlKey || e.metaKey) && e.key === 'z' && !e.shiftKey) {
                    e.preventDefault();
                    undoDraft(state.editingDraftId);
                } else if ((e.ctrlKey || e.metaKey) && (e.key === 'y' || (e.key === 'z' && e.shiftKey))) {
                    e.preventDefault();
                    redoDraft(state.editingDraftId);
                }
            }
        });

        // Track which draft is being edited for keyboard shortcuts
        document.addEventListener('focusin', (e) => {
            if (e.target.classList.contains('draft-post-content')) {
                const id = e.target.id.replace('draft-content-', '');
                state.editingDraftId = parseInt(id);
            }
        });

        document.addEventListener('focusout', (e) => {
            if (e.target.classList.contains('draft-post-content')) {
                state.editingDraftId = null;
            }
        });

        // Initialize on load
        loadTheme();
        init();
        updateNavCounts();
    </script>
</body>
</html>