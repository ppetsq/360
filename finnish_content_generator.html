<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Finnish Content Generator</title>
<style>
:root {
/* Brand Colors */
--brand-orange: #EF5900;
--brand-yellow: #FFDF4D;
--brand-green: #87D156;
--brand-dark: #050505;
--brand-gray: #999999;
--brand-light: #E6E6E6;

/* Light Theme */
--bg-gradient-start: #fafafa;
--bg-gradient-end: #f5f5f5;
--container-bg: #ffffff;
--text-primary: #050505;
--text-secondary: #999999;
--border-color: #E6E6E6;
--input-bg: #ffffff;
--input-border: #E6E6E6;
--button-primary-bg: #EF5900;
--button-primary-hover: #d64f00;
--button-secondary-bg: #E6E6E6;
--button-secondary-hover: #999999;
--card-bg: #f9f9f9;
}

[data-theme="dark"] {
--bg-gradient-start: #050505;
--bg-gradient-end: #1a1a1a;
--container-bg: #1a1a1a;
--text-primary: #E6E6E6;
--text-secondary: #999999;
--border-color: #333333;
--input-bg: #252525;
--input-border: #333333;
--button-primary-bg: #EF5900;
--button-primary-hover: #ff6b0a;
--button-secondary-bg: #252525;
--button-secondary-hover: #333333;
--card-bg: #252525;
}

* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

body {
font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
background: var(--bg-gradient-start);
min-height: 100vh;
display: flex;
flex-direction: column;
transition: background 0.3s ease;
}

/* Header */
.header {
background: var(--container-bg);
border-bottom: 1px solid var(--border-color);
padding: 20px 30px;
display: flex;
justify-content: space-between;
align-items: center;
}

.header-title {
font-size: 20px;
font-weight: 700;
color: var(--text-primary);
}

.header-subtitle {
font-size: 13px;
color: var(--text-secondary);
margin-top: 4px;
}

.theme-toggle-wrapper {
display: flex;
align-items: center;
gap: 12px;
}

.theme-toggle-label {
font-size: 13px;
color: var(--text-secondary);
font-weight: 500;
}

.theme-toggle {
position: relative;
width: 44px;
height: 24px;
background: var(--button-secondary-bg);
border-radius: 12px;
cursor: pointer;
transition: background 0.3s;
}

.theme-toggle.dark {
background: var(--brand-orange);
}

.theme-toggle-thumb {
position: absolute;
top: 3px;
left: 3px;
width: 18px;
height: 18px;
background: white;
border-radius: 50%;
transition: transform 0.3s;
box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.theme-toggle.dark .theme-toggle-thumb {
transform: translateX(20px);
}

/* Main Container */
.main-container {
flex: 1;
display: flex;
flex-direction: column;
max-width: 1200px;
width: 100%;
margin: 0 auto;
padding: 30px;
gap: 20px;
}

/* Source Material Section */
.source-section {
background: var(--container-bg);
border-radius: 12px;
padding: 25px;
border: 1px solid var(--border-color);
}

.section-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 20px;
}

.section-title {
font-size: 16px;
font-weight: 600;
color: var(--text-primary);
}

.add-source-btn {
padding: 8px 16px;
background: var(--button-primary-bg);
color: white;
border: none;
border-radius: 8px;
font-size: 13px;
font-weight: 600;
cursor: pointer;
transition: all 0.2s;
}

.add-source-btn:hover {
background: var(--button-primary-hover);
}

.source-list {
display: flex;
flex-direction: column;
gap: 12px;
}

.source-item {
background: var(--card-bg);
border: 1px solid var(--border-color);
border-radius: 8px;
padding: 15px;
position: relative;
}

.source-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 10px;
}

.source-label {
font-size: 12px;
font-weight: 600;
color: var(--text-secondary);
text-transform: uppercase;
letter-spacing: 0.5px;
}

.source-actions {
display: flex;
gap: 8px;
}

.source-char-count {
font-size: 11px;
color: var(--text-secondary);
}

.remove-source-btn {
padding: 4px 8px;
background: #ff6b6b;
color: white;
border: none;
border-radius: 4px;
font-size: 11px;
font-weight: 600;
cursor: pointer;
transition: all 0.2s;
}

.remove-source-btn:hover {
background: #ff5252;
}

.source-textarea {
width: 100%;
min-height: 120px;
padding: 12px;
border: 1px solid var(--input-border);
border-radius: 6px;
font-size: 14px;
font-family: inherit;
resize: vertical;
background: var(--input-bg);
color: var(--text-primary);
transition: all 0.2s;
}

.source-textarea:focus {
outline: none;
border-color: var(--brand-orange);
}

.source-empty {
text-align: center;
padding: 40px 20px;
color: var(--text-secondary);
font-size: 14px;
}

/* Chat Section */
.chat-section {
flex: 1;
background: var(--container-bg);
border-radius: 12px;
border: 1px solid var(--border-color);
display: flex;
flex-direction: column;
overflow: hidden;
min-height: 400px;
}

.chat-header {
padding: 20px 25px;
border-bottom: 1px solid var(--border-color);
display: flex;
justify-content: space-between;
align-items: center;
}

.chat-messages {
flex: 1;
overflow-y: auto;
padding: 25px;
display: flex;
flex-direction: column;
gap: 20px;
}

.message {
display: flex;
flex-direction: column;
gap: 8px;
}

.message-header {
display: flex;
align-items: center;
gap: 10px;
}

.message-author {
font-size: 13px;
font-weight: 600;
color: var(--text-primary);
}

.message-author.user {
color: var(--brand-orange);
}

.message-author.assistant {
color: var(--brand-green);
}

.message-time {
font-size: 11px;
color: var(--text-secondary);
}

.message-content {
background: var(--card-bg);
border: 1px solid var(--border-color);
border-radius: 8px;
padding: 15px;
line-height: 1.6;
color: var(--text-primary);
white-space: pre-wrap;
word-wrap: break-word;
}

.message-content.user {
background: rgba(239, 89, 0, 0.05);
border-color: var(--brand-orange);
}

.message-content.assistant {
background: var(--card-bg);
}

.loading-indicator {
display: flex;
align-items: center;
gap: 8px;
color: var(--text-secondary);
font-size: 14px;
}

.loading-dots {
display: flex;
gap: 4px;
}

.loading-dot {
width: 6px;
height: 6px;
border-radius: 50%;
background: var(--text-secondary);
animation: pulse 1.4s infinite;
}

.loading-dot:nth-child(2) {
animation-delay: 0.2s;
}

.loading-dot:nth-child(3) {
animation-delay: 0.4s;
}

@keyframes pulse {
0%, 60%, 100% {
opacity: 0.4;
transform: scale(0.8);
}
30% {
opacity: 1;
transform: scale(1);
}
}

.chat-empty {
flex: 1;
display: flex;
align-items: center;
justify-content: center;
text-align: center;
color: var(--text-secondary);
font-size: 14px;
padding: 40px 20px;
}

/* Input Section */
.chat-input-container {
padding: 20px 25px;
border-top: 1px solid var(--border-color);
background: var(--container-bg);
}

.chat-input-wrapper {
display: flex;
gap: 12px;
align-items: flex-end;
}

.chat-input {
flex: 1;
min-height: 44px;
max-height: 200px;
padding: 12px 16px;
border: 2px solid var(--input-border);
border-radius: 8px;
font-size: 14px;
font-family: inherit;
resize: none;
background: var(--input-bg);
color: var(--text-primary);
transition: all 0.2s;
overflow-y: auto;
}

.chat-input:focus {
outline: none;
border-color: var(--brand-orange);
}

.send-btn {
padding: 12px 24px;
background: var(--button-primary-bg);
color: white;
border: none;
border-radius: 8px;
font-size: 14px;
font-weight: 600;
cursor: pointer;
transition: all 0.2s;
white-space: nowrap;
}

.send-btn:hover:not(:disabled) {
background: var(--button-primary-hover);
box-shadow: 0 4px 12px rgba(239, 89, 0, 0.3);
}

.send-btn:disabled {
opacity: 0.5;
cursor: not-allowed;
}

.clear-chat-btn {
padding: 8px 16px;
background: var(--button-secondary-bg);
color: var(--text-secondary);
border: none;
border-radius: 6px;
font-size: 12px;
font-weight: 600;
cursor: pointer;
transition: all 0.2s;
}

.clear-chat-btn:hover {
background: var(--button-secondary-hover);
}

/* Scrollbar Styling */
.chat-messages::-webkit-scrollbar {
width: 8px;
}

.chat-messages::-webkit-scrollbar-track {
background: var(--card-bg);
}

.chat-messages::-webkit-scrollbar-thumb {
background: var(--border-color);
border-radius: 4px;
}

.chat-messages::-webkit-scrollbar-thumb:hover {
background: var(--text-secondary);
}

/* Responsive */
@media (max-width: 768px) {
.main-container {
padding: 15px;
}

.source-section, .chat-section {
padding: 15px;
}

.header {
padding: 15px;
}
}
</style>
</head>
<body>
<!-- Header -->
<div class="header">
<div>
<div class="header-title">Finnish Content Generator</div>
<div class="header-subtitle">Powered by Claude Sonnet 3.7</div>
</div>
<div class="theme-toggle-wrapper">
<span class="theme-toggle-label">Dark</span>
<div class="theme-toggle" id="themeToggle" onclick="toggleTheme()">
<div class="theme-toggle-thumb"></div>
</div>
</div>
</div>

<!-- Main Container -->
<div class="main-container">
<!-- Source Material Section -->
<div class="source-section">
<div class="section-header">
<div>
<div class="section-title">Source Material</div>
<div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">
Files over 5,000 characters will be automatically attached
</div>
</div>
<button class="add-source-btn" onclick="addSourceItem()">+ Add Source</button>
</div>
<div class="source-list" id="sourceList">
<div class="source-empty">No source material added. Click "Add Source" to paste your content.</div>
</div>
</div>

<!-- Chat Section -->
<div class="chat-section">
<div class="chat-header">
<div class="section-title">Conversation</div>
<button class="clear-chat-btn" onclick="clearChat()">Clear Chat</button>
</div>
<div class="chat-messages" id="chatMessages">
<div class="chat-empty">
<div>
<p><strong>Welcome!</strong></p>
<p style="margin-top: 10px;">Add your source material above, then start chatting below.</p>
<p style="margin-top: 5px; font-size: 12px;">Tip: I'll automatically detect if you're writing in Finnish or English.</p>
</div>
</div>
</div>
<div class="chat-input-container">
<div class="chat-input-wrapper">
<textarea
class="chat-input"
id="chatInput"
placeholder="Type your message here..."
rows="1"
onkeydown="handleInputKeydown(event)"
oninput="autoResize(this)"
></textarea>
<button class="send-btn" id="sendBtn" onclick="sendMessage()">Send</button>
</div>
</div>
</div>
</div>

<script>
// State Management
const state = {
sources: [],
messages: [],
isGenerating: false,
nextSourceId: 1
};

// Auto-resize textarea
function autoResize(textarea) {
textarea.style.height = 'auto';
textarea.style.height = Math.min(textarea.scrollHeight, 200) + 'px';
}

// Handle Enter key in input
function handleInputKeydown(event) {
if (event.key === 'Enter' && !event.shiftKey) {
event.preventDefault();
sendMessage();
}
}

// Add source item
function addSourceItem() {
const id = state.nextSourceId++;
const source = {
id: id,
content: ''
};

state.sources.push(source);
renderSources();

// Focus the new textarea
setTimeout(() => {
const textarea = document.getElementById(`source-${id}`);
if (textarea) textarea.focus();
}, 100);
}

// Remove source item
function removeSourceItem(id) {
state.sources = state.sources.filter(s => s.id !== id);
renderSources();
}

// Update source content
function updateSourceContent(id, content) {
const source = state.sources.find(s => s.id === id);
if (source) {
source.content = content;
renderSources();
}
}

// Get character count for display
function getCharCount(text) {
const count = text.length;
if (count > 5000) {
return `${count.toLocaleString()} chars (will attach)`;
} else {
return `${count.toLocaleString()} chars`;
}
}

// Render sources
function renderSources() {
const container = document.getElementById('sourceList');

if (state.sources.length === 0) {
container.innerHTML = '<div class="source-empty">No source material added. Click "Add Source" to paste your content.</div>';
return;
}

container.innerHTML = state.sources.map((source, index) => `
<div class="source-item">
<div class="source-header">
<div class="source-label">Source ${index + 1}</div>
<div class="source-actions">
<span class="source-char-count" id="char-count-${source.id}">${getCharCount(source.content)}</span>
<button class="remove-source-btn" onclick="removeSourceItem(${source.id})">Remove</button>
</div>
</div>
<textarea
class="source-textarea"
id="source-${source.id}"
placeholder="Paste your source material here..."
oninput="updateSourceContent(${source.id}, this.value)"
>${source.content}</textarea>
</div>
`).join('');
}

// Format time
function formatTime() {
const now = new Date();
return now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
}

// Add message to chat
function addMessage(role, content) {
const message = {
role: role,
content: content,
timestamp: formatTime()
};

state.messages.push(message);
renderMessages();
scrollToBottom();
}

// Render messages
function renderMessages() {
const container = document.getElementById('chatMessages');

if (state.messages.length === 0) {
container.innerHTML = `
<div class="chat-empty">
<div>
<p><strong>Welcome!</strong></p>
<p style="margin-top: 10px;">Add your source material above, then start chatting below.</p>
<p style="margin-top: 5px; font-size: 12px;">Tip: I'll automatically detect if you're writing in Finnish or English.</p>
</div>
</div>
`;
return;
}

container.innerHTML = state.messages.map(msg => `
<div class="message">
<div class="message-header">
<span class="message-author ${msg.role}">${msg.role === 'user' ? 'You' : 'Assistant'}</span>
<span class="message-time">${msg.timestamp}</span>
</div>
<div class="message-content ${msg.role}">${escapeHtml(msg.content)}</div>
</div>
`).join('');
}

// Escape HTML
function escapeHtml(text) {
const div = document.createElement('div');
div.textContent = text;
return div.innerHTML;
}

// Scroll to bottom of chat
function scrollToBottom() {
const container = document.getElementById('chatMessages');
setTimeout(() => {
container.scrollTop = container.scrollHeight;
}, 100);
}

// Show loading indicator
function showLoading() {
const container = document.getElementById('chatMessages');
const loadingHtml = `
<div class="message" id="loadingMessage">
<div class="message-header">
<span class="message-author assistant">Assistant</span>
<span class="message-time">${formatTime()}</span>
</div>
<div class="message-content assistant">
<div class="loading-indicator">
<span>Thinking</span>
<div class="loading-dots">
<div class="loading-dot"></div>
<div class="loading-dot"></div>
<div class="loading-dot"></div>
</div>
</div>
</div>
</div>
`;
container.insertAdjacentHTML('beforeend', loadingHtml);
scrollToBottom();
}

// Remove loading indicator
function removeLoading() {
const loadingMsg = document.getElementById('loadingMessage');
if (loadingMsg) {
loadingMsg.remove();
}
}

// Build API messages
function buildApiMessages(newUserMessage) {
const messages = [];

// Check if we need to include source material (only on first message)
const isFirstMessage = state.messages.length === 0;
const hasSources = state.sources.length > 0 && state.sources.some(s => s.content.trim());

if (isFirstMessage && hasSources) {
// Build content array with sources + user message
let contentArray = [];

// Add source materials
state.sources.forEach((source, index) => {
const content = source.content.trim();
if (!content) return;

// If content is long (>5000 chars), add as document attachment
if (content.length > 5000) {
contentArray.push({
type: "document",
source: {
type: "text",
media_type: "text/plain",
data: content
},
title: `Source ${index + 1}`
});
} else {
// For shorter content, include inline
contentArray.push({
type: "text",
text: `<source_${index + 1}>\n${content}\n</source_${index + 1}>\n\n`
});
}
});

// Add user's message
contentArray.push({
type: "text",
text: newUserMessage
});

messages.push({
role: "user",
content: contentArray
});
} else {
// Add conversation history
state.messages.forEach(msg => {
messages.push({
role: msg.role,
content: msg.content
});
});

// Add new user message
messages.push({
role: "user",
content: newUserMessage
});
}

return messages;
}

// Send message
async function sendMessage() {
const input = document.getElementById('chatInput');
const userMessage = input.value.trim();

if (!userMessage || state.isGenerating) return;

// Clear input immediately
input.value = '';
input.style.height = 'auto';

// Disable input
state.isGenerating = true;
document.getElementById('sendBtn').disabled = true;
document.getElementById('chatInput').disabled = true;

// Build API messages (before adding to state, so we can detect if it's first message)
const apiMessages = buildApiMessages(userMessage);

// Add user message to state
addMessage('user', userMessage);

// Show loading
showLoading();

try {
const response = await callClaudeAPI(apiMessages);

removeLoading();
addMessage('assistant', response);
} catch (error) {
console.error('API Error:', error);
removeLoading();
addMessage('assistant', 'Sorry, there was an error generating a response. Please try again.');
}

// Re-enable input
state.isGenerating = false;
document.getElementById('sendBtn').disabled = false;
document.getElementById('chatInput').disabled = false;
document.getElementById('chatInput').focus();
}

// Call Claude API
async function callClaudeAPI(messages) {
try {
const response = await fetch("https://api.anthropic.com/v1/messages", {
method: "POST",
headers: {
"Content-Type": "application/json",
},
body: JSON.stringify({
model: "claude-3-7-sonnet-20250219",
max_tokens: 4000,
temperature: 1.0,
messages: messages
})
});

if (!response.ok) {
throw new Error(`API request failed: ${response.status}`);
}

const data = await response.json();
return data.content[0].text.trim();
} catch (error) {
console.error('API Error:', error);
throw error;
}
}

// Clear chat
function clearChat() {
if (state.messages.length === 0) return;

if (confirm('Are you sure you want to clear the conversation history?')) {
state.messages = [];
renderMessages();
}
}

// Toggle theme
function toggleTheme() {
const html = document.documentElement;
const themeToggle = document.getElementById('themeToggle');
const currentTheme = html.getAttribute('data-theme');

if (currentTheme === 'dark') {
html.removeAttribute('data-theme');
themeToggle.classList.remove('dark');
localStorage.setItem('theme', 'light');
} else {
html.setAttribute('data-theme', 'dark');
themeToggle.classList.add('dark');
localStorage.setItem('theme', 'dark');
}
}

// Load theme
function loadTheme() {
const savedTheme = localStorage.getItem('theme');
const themeToggle = document.getElementById('themeToggle');

if (savedTheme === 'dark') {
document.documentElement.setAttribute('data-theme', 'dark');
if (themeToggle) themeToggle.classList.add('dark');
}
}

// Initialize
function init() {
loadTheme();
renderSources();
renderMessages();
}

// Run on page load
document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
